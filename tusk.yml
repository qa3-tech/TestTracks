tasks:
  build:
    usage: Build the test runner
    options:
      build_config:
        usage: build configuration of binary. Default is Debug.
        default: "Debug"
    run:
      - dotnet build src -c ${build_config} --no-restore  /property:GenerateFullPaths=true /consoleloggerparameters:NoSummary -o build -nologo
      - dotnet build csharp -c ${build_config} --no-restore  /property:GenerateFullPaths=true /consoleloggerparameters:NoSummary -o build -nologo
  build-tests:
    usage: Build the tests runner's tests
    run:
      - dotnet build tests -c Debug --no-restore /property:GenerateFullPaths=true /consoleloggerparameters:NoSummary -o build -nologo
      - dotnet build csharp.tests -c Debug --no-restore /property:GenerateFullPaths=true /consoleloggerparameters:NoSummary -o build -nologo
  clean:
    usage: Remove all build artifacts
    run:
      - rm -rf build
      - dotnet clean src
      - dotnet clean tests
      - dotnet clean csharp
      - dotnet clean csharp.tests
      - dotnet restore src --force-evaluate
      - dotnet restore tests --force-evaluate
      - dotnet restore csharp --force-evaluate
      - dotnet restore csharp.tests --force-evaluate
  test:
    usage: Run tests
    run:
      - task:
          name: clean
      - task:
          name: build-tests
      - command:
          exec: ./TestTracks.Tests | tee output.txt
          dir: build
      - command:
          exec: ./TestTracksCSharp.Tests | tee cs-output.txt
          dir: build
  release:
    usage: Release package of library
    options:
      version:
        usage: version of application
        environment: RELEASE_VERSION
        default: "0.0.0"
    run:
      - task:
          name: clean
      - command:
          exec: dotnet publish src -c Release --self-contained=false /property:Version=${version} /property:DebugType=none /property:GenerateFullPaths=true /consoleloggerparameters:NoSummary -o build -nologo
      - command:
          exec: dotnet publish csharp -c Release --self-contained=false /property:Version=${version} /property:DebugType=none /property:GenerateFullPaths=true /consoleloggerparameters:NoSummary -o build -nologo
      - command:
          exec: tar -cJf ../TestTracks-${version}.tar.xz *
          dir: ./build
